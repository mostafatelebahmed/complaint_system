import os
from database.connection import init_db, get_db
from database.models import Department
from services.auth_service import AuthService

# ุชุฃูุฏ ุฃู ูุฐุง ุงูุงุณู ูุทุงุจู ุงุณู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ูุดุฑูุนู
DB_FILE = "complaints.db"

def seed_users():
    # 1. ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ ูุจุฏุก ุตูุญุฉ ุฌุฏูุฏุฉ ูุธููุฉ
    if os.path.exists(DB_FILE):
        try:
            os.remove(DB_FILE)
            print(f"๐๏ธ ุชู ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ '{DB_FILE}' ุจูุฌุงุญ.")
        except Exception as e:
            print(f"โ๏ธ ุชุญุฐูุฑ: ูู ูุชููู ูู ุญุฐู ุงูููู (ูุฏ ูููู ููุชูุญุงู): {e}")
            return

    # 2. ุจูุงุก ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ
    print("โ๏ธ ุฌุงุฑู ุจูุงุก ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช...")
    init_db()
    
    db = next(get_db())
    auth = AuthService()
    
    # 3. ุชุนุฑูู ุงูุฅุฏุงุฑุงุช ูุงููุณุชุฎุฏููู
    # ููุช ุจุนูู Mapping: ุงุณู ุฏุฎูู ุงูุฌููุฒู -> ุงูุงุณู ุงูุนุฑุจู ุงูุฑุณูู
    users_data = [
        # ุงููุฏูุฑ ุงูุนุงู
        {"user": "admin", "pass": "admin123", "name": "ูุฏูุฑ ุงููุธุงู", "role": "Admin"},
        
        # ุงูุฅุฏุงุฑุงุช ุงูุณุจุนุฉ ุงูุฌุฏูุฏุฉ
        {"user": "cairo_hist", "pass": "123456", "name": "ูุฌูุฉ ุงุฏุงุฑุฉ ูุดุฑูุน ุงููุงูุฑู ุงูุชุงุฑูุฎูู", "role": "User"},
        {"user": "public_rel", "pass": "123456", "name": "ุงูุงุฏุงุฑู ุงูุนุงูู ููุงุชุตุงู ุงูุณูุงุณู ูุฎุฏูุฉ ุงูููุงุทููู", "role": "User"},
        {"user": "real_estate", "pass": "123456", "name": "ูุฌูุฉ ุงุฏุงุฑุฉ ุงูุดุคูู ุงูุนูุงุฑูุฉ ู ุงูุชุฌุงุฑูุฉ", "role": "User"},
        {"user": "finance_hr", "pass": "123456", "name": "ุงูุฅุฏุงุฑุฉ ุงููุฑูุฒูุฉ ููุดุคูู ุงููุงููุฉ ู ุงูุฅุฏุงุฑูุฉ ู ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ", "role": "User"},
        {"user": "projects",   "pass": "123456", "name": "ุงูุฅุฏุงุฑุฉ ุงููุฑูุฒูุฉ ูุชูููุฐ ู ูุชุงุจุนุฉ ุงููุดุฑูุนุงุช", "role": "User"},
        {"user": "legal",      "pass": "123456", "name": "ุงูุฅุฏุงุฑุฉ ุงูุนุงูุฉ ุงููุงููููุฉ", "role": "User"},
        {"user": "accounts",   "pass": "123456", "name": "ุฅุฏุงุฑุฉ ุญุณุงุจุงุช ุงููุดุงุฑูุน ู ุงูุจููู", "role": "User"},
    ]
    
    # 4. ุฅุถุงูุฉ ุงูุฅุฏุงุฑุงุช ูุฌุฏูู Departments (ููู ุฌุฏุงู ููุฑุจุท)
    print("--- ุฌุงุฑู ุชุณุฌูู ุงูุฅุฏุงุฑุงุช ---")
    for u in users_data:
        if u['role'] == 'User': # ูุชุฌุงูู ุงูุฃุฏูู ูุฃูู ููุณ ุฅุฏุงุฑุฉ
            dept = Department(name=u['name'])
            db.add(dept)
    db.commit()
    print("โ ุชู ุชุณุฌูู ุงูุฅุฏุงุฑุงุช ูู ุงููุธุงู.")

    # 5. ุฅูุดุงุก ุงููุณุชุฎุฏููู
    print("--- ุฌุงุฑู ุฅูุดุงุก ุญุณุงุจุงุช ุงูุฏุฎูู ---")
    for u in users_data:
        # ูููุฉ ุงููุฑูุฑ ููุญุฏุฉ ููุชุฌุฑุจุฉ: 123456
        if auth.create_user(db, u['user'], u['name'], u['pass'], u['role']):
            print(f"๐ค ุชู ุฅูุดุงุก: {u['name']} (User: {u['user']})")
        else:
            print(f"โน๏ธ ููุฌูุฏ ูุณุจูุงู: {u['user']}")
            
    print("\n--- โ ุชูุช ุงูุนูููุฉ ุจูุฌุงุญ! ---")
    print("ุจูุงูุงุช ุงูุฏุฎูู ููุชุฌุฑุจุฉ:")
    print("User: admin       | Pass: admin123")
    print("User: legal       | Pass: 123456")
    print("User: cairo_hist  | Pass: 123456")

if __name__ == "__main__":
    seed_users()